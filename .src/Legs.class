' Gambas class file

Public TheLeg As Leg = New Leg


Public Sub Form_Open()
Dim Names As String
Dim LegNames As String[] 

  names = Settings["LegNames"]
  If Not IsNull(names) Then
    LegName.list = Split(names, "|")
  Endif
  
  ShoulderServo.List = FMain.CurrentServo.List
  UpperServo.list = FMain.CurrentServo.List
  LowerServo.list = FMain.CurrentServo.List
  TheLeg.ServoBroadcast = FMain.SrvManager.OpenServo(0)

End

Public Sub ShoulderServo_Click()

  TheLeg.ServoShoulder = FMain.SrvManager.OpenServo(Str(ShoulderServo.text))
  TheLeg.ShoulderAngle = TheLeg.ServoShoulder.HomePosition
  
End

Public Sub UpperServo_Click()

  TheLeg.ServoUpper = FMain.SrvManager.OpenServo(Str(UpperServo.text))

End

Public Sub LowerServo_Click()

   TheLeg.ServoLower = FMain.SrvManager.OpenServo(Str(LowerServo.text))

End

Public Sub UpDown_Change()

  TheLeg.DistanceToGround = CFloat(UpDown.value) * ((TheLeg.legLowerLen + TheLeg.legUpperLen) / UpDown.MaxValue)
  TheLeg.MoveToPosition()

End

Public Sub ForwardBackward_Change()

  TheLeg.UpperAngle = ForwardBackward.value * 0.24
  TheLeg.MoveToPosition()
End

Public Sub SetShoulderOffsetAngle_Change()

  TheLeg.ShoulderOffset = SetShoulderOffsetAngle.Value
    TheLeg.MoveToPosition()

End

Public Sub UpperLegOffsetAngleAdjust_Change()

  TheLeg.LegUpperOffset = UpperLegOffsetAngleAdjust.Value
  TheLeg.MoveToPosition()
End

Public Sub LowerLegOffsetAngleAdjust_Change()

   TheLeg.LegLowerOffset = LowerLegOffsetAngleAdjust.Value
   TheLeg.MoveToPosition()
End

Public Sub SaveServoSettings_Click()
Dim Names As String
Dim LegNames As String[] 

  names = Settings["LegNames"]
  Legnames = Split(names, "|")
  If LegNames.Find(LegName.text) = -1 Then
    names = names & LegName.text & ""
    Settings["LegNames"] = names
  Endif
  
  Settings["Leg" & LegName.text & "/ShoulderServoID"] = TheLeg.ServoShoulder.ServoID
  Settings["Leg" & LegName.text & "/UpperServoID"] = TheLeg.ServoUpper.ServoID
  Settings["Leg" & LegName.text & "/LowerServoID"] = TheLeg.ServoLower.ServoID

  Settings["Leg" & LegName.text & "/ShoulderAngleOffset"] = TheLeg.ShoulderOffset
  Settings["Leg" & LegName.text & "/UpperAngleOffset"] = TheLeg.LegUpperOffset
  Settings["Leg" & LegName.text & "/LowerAngleOffset"] = TheLeg.LegLowerOffset
  Settings["Leg" & LegName.text & "/DistanceToGround"] = TheLeg.DistanceToGround
  Settings["Leg" & LegName.text & "/LegUpperLen"] = TheLeg.legUpperLen
  Settings["Leg" & LegName.text & "/LegLowerLen"] = TheLeg.legLowerLen
  

End

Public Sub LoadServoSettings_Click()
  
  TheLeg.ServoShoulder = FMain.SrvManager.OpenServo(Settings["Leg" & LegName.text & "/ShoulderServoID"])
  TheLeg.ServoUpper = FMain.SrvManager.OpenServo(Settings["Leg" & LegName.text & "/UpperServoID"])
  TheLeg.ServoLower = FMain.SrvManager.OpenServo(Settings["Leg" & LegName.text & "/LowerServoID"])
   
  TheLeg.ShoulderOffset = Settings["Leg" & LegName.text & "/ShoulderAngleOffset"]
  TheLeg.LegUpperOffset = Settings["Leg" & LegName.text & "/UpperAngleOffset"]
  TheLeg.LegLowerOffset = Settings["Leg" & LegName.text & "/LowerAngleOffset"]
  TheLeg.DistanceToGround = Settings["Leg" & LegName.text & "/DistanceToGround"]
  TheLeg.legUpperLen = Settings["Leg" & LegName.text & "/LegUpperLen"]
  TheLeg.legLowerLen = Settings["Leg" & LegName.text & "/LegLowerLen"] 

End
