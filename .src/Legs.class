' Gambas class file

Public TheLeg As Leg = New Leg
Public NewFile As Settings = New Settings("/home/brian/Robots/legsets.conf")


Public Sub Form_Open()
Dim Names As String

  names = NewFile["LegNames", "Basic"]
  If Not IsNull(names) Then
    LegName.list = Split(names, "|")
    LegName.index = 0
  Endif
  
  ShoulderServo.List = FMain.CurrentServo.List
  
  UpperServo.list = FMain.CurrentServo.List
  
  LowerServo.list = FMain.CurrentServo.List
  
  TheLeg.ServoBroadcast = FMain.SrvManager.OpenServo(0)

End

Public Sub ShoulderServo_Click()

  TheLeg.ServoShoulder = FMain.SrvManager.OpenServo(Str(ShoulderServo.text))
  TheLeg.ShoulderAngle = TheLeg.ServoShoulder.HomePosition
  
End

Public Sub UpperServo_Click()

  TheLeg.ServoUpper = FMain.SrvManager.OpenServo(Str(UpperServo.text))

End

Public Sub LowerServo_Click()

   TheLeg.ServoLower = FMain.SrvManager.OpenServo(Str(LowerServo.text))

End

Public Sub UpDown_Change()

  TheLeg.DistanceToGround = CFloat(UpDown.value) * ((TheLeg.legLowerLen + TheLeg.legUpperLen) / UpDown.MaxValue)
  TheLeg.MoveToPosition()

End

Public Sub ForwardBackward_Change()

  TheLeg.UpperAngle = ForwardBackward.value * 0.24
  TheLeg.MoveToPosition()
End

Public Sub SetShoulderOffsetAngle_Change()

  TheLeg.ShoulderOffset = SetShoulderOffsetAngle.Value
    TheLeg.MoveAdjust()

End

Public Sub UpperLegOffsetAngleAdjust_Change()

  TheLeg.LegUpperOffset = UpperLegOffsetAngleAdjust.Value
  TheLeg.MoveAdjust()
End

Public Sub LowerLegOffsetAngleAdjust_Change()

   TheLeg.LegLowerOffset = LowerLegOffsetAngleAdjust.Value
   TheLeg.MoveAdjust()
End

Public Sub SaveServoSettings_Click()
Dim Names As String
Dim LegNames As String[] 


  names = NewFile["LegNames"]
  Legnames = Split(names, "|")
  If LegNames.Find(LegName.text) = -1 Then
    names = names & LegName.text & ""
    NewFile["LegNames"] = names
    NewFile.Save()
  Endif
  
  NewFile["Leg" & LegName.text & "/ShoulderServoID"] = TheLeg.ServoShoulder.ServoID
  NewFile["Leg" & LegName.text & "/UpperServoID"] = TheLeg.ServoUpper.ServoID
  NewFile["Leg" & LegName.text & "/LowerServoID"] = TheLeg.ServoLower.ServoID

  NewFile["Leg" & LegName.text & "/ShoulderAngleOffset"] = TheLeg.ShoulderOffset
  NewFile["Leg" & LegName.text & "/UpperAngleOffset"] = TheLeg.LegUpperOffset
  NewFile["Leg" & LegName.text & "/LowerAngleOffset"] = TheLeg.LegLowerOffset
  NewFile["Leg" & LegName.text & "/DistanceToGround"] = TheLeg.DistanceToGround
  NewFile["Leg" & LegName.text & "/LegUpperLen"] = TheLeg.legUpperLen
  NewFile["Leg" & LegName.text & "/LegLowerLen"] = TheLeg.legLowerLen
  NewFile.Save()

End

Public Sub LoadServoSettings_Click()
  
  TheLeg.ServoShoulder = FMain.SrvManager.OpenServo(NewFile["Leg" & LegName.text & "/ShoulderServoID"])
  TheLeg.ServoUpper = FMain.SrvManager.OpenServo(NewFile["Leg" & LegName.text & "/UpperServoID"])
  TheLeg.ServoLower = FMain.SrvManager.OpenServo(NewFile["Leg" & LegName.text & "/LowerServoID"])
   
  TheLeg.ShoulderOffset = NewFile["Leg" & LegName.text & "/ShoulderAngleOffset"]
  TheLeg.LegUpperOffset = NewFile["Leg" & LegName.text & "/UpperAngleOffset"]
  TheLeg.LegLowerOffset = NewFile["Leg" & LegName.text & "/LowerAngleOffset"]
  TheLeg.DistanceToGround = NewFile["Leg" & LegName.text & "/DistanceToGround"]
  TheLeg.legUpperLen = NewFile["Leg" & LegName.text & "/LegUpperLen"]
  TheLeg.legLowerLen = NewFile["Leg" & LegName.text & "/LegLowerLen"] 
  
  NewFile.Save()
End

Public Sub MoveToZero_Click()

  TheLeg.MoveToZeroPosition()

End
